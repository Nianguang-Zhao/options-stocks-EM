<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tools for Options Pricing: SPY Expected Move</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/date-fns/2.29.3/index.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        header h1 {
            font-size: 2.5rem;
            color: #2c3e50;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #7f8c8d;
            font-weight: 300;
        }

        main {
            padding: 3rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
        }

        .controls {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            align-items: end;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #2c3e50;
            font-size: 0.9rem;
        }

        .input-group input {
            padding: 12px 16px;
            border: 2px solid #e0e6ed;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .input-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .update-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .update-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            position: relative;
            height: 600px;
        }

        .loading {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 1.2rem;
            color: #667eea;
            font-weight: 600;
        }

        .stats {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            margin-top: 2rem;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            border-radius: 15px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            font-size: 0.9rem;
            color: #7f8c8d;
            font-weight: 500;
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2rem;
            }
            
            main {
                padding: 2rem 1rem;
            }
            
            .controls {
                grid-template-columns: 1fr;
                padding: 1.5rem;
            }
            
            .chart-container {
                height: 400px;
                padding: 1rem;
            }
        }

        .error-message {
            background: #fee;
            border: 1px solid #fcc;
            color: #c33;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
            display: none;
        }

        footer {
            text-align: center;
            padding: 2rem;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <header>
        <h1>Tools for Options Pricing: SPY Expected Move</h1>
        <div class="subtitle">Real-time Probability Analysis for SPY Options Trading</div>
    </header>
    
    <main>
        <div class="controls">
            <div class="input-group">
                <label for="stock-price">Current SPY Price ($)</label>
                <input type="number" id="stock-price" step="0.01" value="579.50">
            </div>
            <div class="input-group">
                <label for="volatility">VIX / Implied Volatility (%)</label>
                <input type="number" id="volatility" step="0.01" value="12.85">
            </div>
            <div class="input-group">
                <label for="risk-free-rate">Risk-Free Rate (%)</label>
                <input type="number" id="risk-free-rate" step="0.001" value="4.1">
            </div>
            <div class="input-group">
                <label for="std-dev">Standard Deviations</label>
                <input type="number" id="std-dev" step="0.1" value="1.0">
            </div>
            <button class="update-btn" onclick="updateChart()">Update Chart</button>
        </div>

        <div class="error-message" id="error-message"></div>

        <div class="chart-container">
            <div class="loading" id="loading">Generating Chart...</div>
            <canvas id="probabilityChart"></canvas>
        </div>

        <div class="stats" id="stats-container"></div>
    </main>

    <footer>
        <p>Built with Chart.js • Data visualization for options trading analysis</p>
    </footer>

    <script>
        let chart = null;

        // Trading days calculation functions
        function isWeekend(date) {
            const day = date.getDay();
            return day === 0 || day === 6; // Sunday = 0, Saturday = 6
        }

        function getNextTradingDay(date, daysAhead = 1) {
            let currentDate = new Date(date);
            let tradingDays = 0;
            
            while (tradingDays < daysAhead) {
                currentDate.setDate(currentDate.getDate() + 1);
                if (!isWeekend(currentDate)) {
                    tradingDays++;
                }
            }
            
            return new Date(currentDate);
        }

        function getTradingDaysList(startDate, numDays) {
            const tradingDays = [];
            let currentDate = new Date(startDate);
            
            for (let i = 0; i < numDays; i++) {
                const nextTradingDay = getNextTradingDay(currentDate, 1);
                tradingDays.push(new Date(nextTradingDay));
                currentDate = nextTradingDay;
            }
            
            return tradingDays;
        }

        function getNextFriday(date) {
            const d = new Date(date);
            const daysUntilFriday = (5 - d.getDay() + 7) % 7;
            if (daysUntilFriday === 0) {
                d.setDate(d.getDate() + 7); // Next Friday if today is Friday
            } else {
                d.setDate(d.getDate() + daysUntilFriday);
            }
            return d;
        }

        function getFridaysList(startDate, endDate) {
            const fridays = [];
            let currentFriday = getNextFriday(startDate);
            
            while (currentFriday <= endDate) {
                fridays.push(new Date(currentFriday));
                currentFriday.setDate(currentFriday.getDate() + 7);
            }
            
            return fridays;
        }

        function calculateExpectedMove(stockPrice, iv, std, dte) {
            return stockPrice * iv * std * Math.sqrt(dte / 365);
        }

        function generateData() {
            const stockPrice = parseFloat(document.getElementById('stock-price').value);
            const volatility = parseFloat(document.getElementById('volatility').value) / 100;
            const riskFreeRate = parseFloat(document.getElementById('risk-free-rate').value) / 100;
            const std = parseFloat(document.getElementById('std-dev').value);
            
            if (!stockPrice || !volatility || !riskFreeRate || !std) {
                throw new Error('Please fill in all required fields with valid numbers');
            }

            const today = new Date();
            const data = [];
            
            // Today's point
            data.push({
                date: new Date(today),
                dte: 0,
                expectedMove: 0,
                upper: stockPrice,
                lower: stockPrice,
                type: 'Today'
            });

            // Daily moves (first 10 trading days)
            const dailyDates = getTradingDaysList(today, 10);
            dailyDates.forEach(date => {
                const dte = Math.ceil((date - today) / (1000 * 60 * 60 * 24));
                const expectedMove = calculateExpectedMove(stockPrice, volatility, std, dte);
                
                data.push({
                    date: new Date(date),
                    dte: dte,
                    expectedMove: expectedMove,
                    upper: stockPrice + expectedMove,
                    lower: stockPrice - expectedMove,
                    type: 'Daily'
                });
            });

            // Weekly moves (Fridays after 10th trading day) - more frequent points for smoother curve
            const lastDailyDate = dailyDates[dailyDates.length - 1];
            const startWeekly = new Date(lastDailyDate);
            startWeekly.setDate(startWeekly.getDate() + 1);
            
            const endDate = new Date(2025, 11, 31); // December 31, 2025
            const fridays = getFridaysList(startWeekly, endDate);
            
            // Add more intermediate points for smoother curve
            const allWeeklyDates = [];
            fridays.forEach((date, index) => {
                allWeeklyDates.push(date);
                // Add mid-week point for smoother interpolation (except for last item)
                if (index < fridays.length - 1) {
                    const midWeek = new Date(date);
                    midWeek.setDate(midWeek.getDate() + 3); // Wednesday between Fridays
                    if (midWeek < fridays[index + 1]) {
                        allWeeklyDates.push(midWeek);
                    }
                }
            });
            
            allWeeklyDates.forEach(date => {
                const dte = Math.ceil((date - today) / (1000 * 60 * 60 * 24));
                const expectedMove = calculateExpectedMove(stockPrice, volatility, std, dte);
                
                data.push({
                    date: new Date(date),
                    dte: dte,
                    expectedMove: expectedMove,
                    upper: stockPrice + expectedMove,
                    lower: stockPrice - expectedMove,
                    type: 'Weekly'
                });
            });

            return { data, stockPrice, volatility };
        }

        function updateChart() {
            const loadingEl = document.getElementById('loading');
            const errorEl = document.getElementById('error-message');
            
            try {
                errorEl.style.display = 'none';
                loadingEl.style.display = 'block';
                
                const { data, stockPrice, volatility } = generateData();
                
                // Prepare chart data
                const labels = data.map(d => d.date.toLocaleDateString());
                const upperBoundData = data.map(d => d.upper);
                const lowerBoundData = data.map(d => d.lower);
                const currentPriceData = data.map(() => stockPrice);

                // Destroy existing chart
                if (chart) {
                    chart.destroy();
                }

                const ctx = document.getElementById('probabilityChart').getContext('2d');
                chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'Upper Bound (+1σ)',
                                data: upperBoundData,
                                borderColor: '#667eea',
                                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                                borderWidth: 3,
                                fill: '+1',
                                pointRadius: 4,
                                pointHoverRadius: 6,
                                tension: 0.4
                            },
                            {
                                label: 'Lower Bound (-1σ)',
                                data: lowerBoundData,
                                borderColor: '#667eea',
                                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                                borderWidth: 3,
                                fill: false,
                                pointRadius: 4,
                                pointHoverRadius: 6,
                                tension: 0.4
                            },
                            {
                                label: 'Current Price',
                                data: currentPriceData,
                                borderColor: '#95a5a6',
                                borderWidth: 2,
                                borderDash: [10, 5],
                                fill: false,
                                pointRadius: 0,
                                pointHoverRadius: 0
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            title: {
                                display: true,
                                text: `Probability Analysis | Range: 68.27% (±1σ) | Volatility: ${(volatility * 100).toFixed(2)}%`,
                                font: { size: 16, weight: 'bold' },
                                padding: 20
                            },
                            legend: {
                                display: true,
                                position: 'top'
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                callbacks: {
                                    title: function(context) {
                                        const index = context[0].dataIndex;
                                        const dataPoint = data[index];
                                        return `${dataPoint.date.toLocaleDateString()} (${dataPoint.dte} DTE)`;
                                    },
                                    label: function(context) {
                                        const value = context.parsed.y;
                                        return `${context.dataset.label}: $${value.toFixed(2)}`;
                                    }
                                }
                            }
                        },
                        scales: {
                            x: {
                                title: {
                                    display: true,
                                    text: 'Expiration Date'
                                },
                                ticks: {
                                    maxTicksLimit: 10,
                                    callback: function(value, index) {
                                        const dataPoint = data[index];
                                        if (dataPoint && (dataPoint.type === 'Weekly' || index % 3 === 0)) {
                                            return dataPoint.date.toLocaleDateString();
                                        }
                                        return '';
                                    }
                                }
                            },
                            y: {
                                title: {
                                    display: true,
                                    text: 'Stock Price ($)'
                                },
                                ticks: {
                                    callback: function(value) {
                                        return '$' + value.toFixed(0);
                                    }
                                }
                            }
                        },
                        interaction: {
                            mode: 'index',
                            intersect: false
                        }
                    }
                });

                // Update stats
                updateStats(data, stockPrice, volatility);
                
                loadingEl.style.display = 'none';
                
            } catch (error) {
                loadingEl.style.display = 'none';
                errorEl.textContent = error.message;
                errorEl.style.display = 'block';
            }
        }

        function updateStats(data, stockPrice, volatility) {
            const container = document.getElementById('stats-container');
            
            // Calculate some key statistics
            const oneDayMove = data.find(d => d.dte === 1);
            const oneWeekData = data.find(d => d.dte >= 5 && d.dte <= 7);
            const oneMonthData = data.find(d => d.dte >= 20 && d.dte <= 25);
            
            const stats = [
                {
                    label: 'Current SPY Price',
                    value: `$${stockPrice.toFixed(2)}`
                },
                {
                    label: 'Implied Volatility',
                    value: `${(volatility * 100).toFixed(2)}%`
                },
                {
                    label: '1-Day Expected Move',
                    value: oneDayMove ? `±$${oneDayMove.expectedMove.toFixed(2)}` : 'N/A'
                },
                {
                    label: '1-Week Expected Move',
                    value: oneWeekData ? `±$${oneWeekData.expectedMove.toFixed(2)}` : 'N/A'
                },
                {
                    label: '1-Month Expected Move',
                    value: oneMonthData ? `±$${oneMonthData.expectedMove.toFixed(2)}` : 'N/A'
                },
                {
                    label: 'Confidence Level',
                    value: '68.27% (±1σ)'
                }
            ];
            
            container.innerHTML = stats.map(stat => `
                <div class="stat-item">
                    <div class="stat-value">${stat.value}</div>
                    <div class="stat-label">${stat.label}</div>
                </div>
            `).join('');
        }

        // Initialize chart on page load
        window.addEventListener('load', () => {
            updateChart();
        });

        // Add enter key support for inputs
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    updateChart();
                }
            });
        });
    </script>
</body>
</html>